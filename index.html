<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF‑8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Map App with Settings</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">
  <style>
    body, html { margin: 0; padding: 0; height: 100%; font-family: sans-serif; }
    #controls, #settings { display: flex; flex-wrap: wrap; gap: 8px; padding: 10px; background: #fff; }
    input, select, button, label { padding: 8px; font-size: 14px; flex: 1 1 150px; }
    button { background: #007bff; color: #fff; border: none; cursor: pointer; }
    #map { height: 65vh; }
    #directions { height: 25vh; overflow-y: auto; padding: 10px; background: #f8f8f8; font-size: 14px; }
    @media(max-width:600px){ input, select, button, label{ flex:1 1 100% } }
    .autocomplete-items { position: absolute; background: #fff; z-index: 1000; border: 1px solid #ccc; }
    .autocomplete-items div { padding: 4px; cursor: pointer; }
    .autocomplete-active { background: #e9e9e9; }
    .select-buttons { margin-top: 4px; display: flex; gap: 4px; }

    #tabs { display: flex; cursor: pointer; margin-bottom: 4px; }
    .tab { padding: 8px 12px; background: #eee; border-radius: 4px 4px 0 0; }
    .tab.active { background: #fff; font-weight: bold; }
    #main, #settings { border: 1px solid #ccc; border-top: none; }
  </style>
</head>
<body>

<div id="tabs">
  <div class="tab active" data-tab="main">Main</div>
  <div class="tab" data-tab="settings">Settings</div>
</div>

<div id="main">
  <div id="controls">
    <input id="search" placeholder="Search place or category...">
    <button id="searchBtn">Search</button>
    <select id="searchType">
      <option value="">All types</option>
      <option value="restaurant">Restaurant</option>
      <option value="supermarket">Supermarket</option>
      <option value="hotel">Hotel</option>
      <option value="gas_station">Gas Station</option>
    </select>
    <input id="start" placeholder="Start location">
    <input id="end" placeholder="End location">
    <button id="routeBtn">Get Route</button>
    <button id="simulateBtn">Start Simulation</button>
    <label><input type="checkbox" id="trafficToggle"> Traffic</label>
  </div>
  <div id="map"></div>
  <div id="directions"></div>
</div>

<div id="settings" style="display:none;">
  <div id="settings-panel">
    <label><input type="checkbox" id="useCurrentLocation"> Use current location as default start</label>
    <label><input type="checkbox" id="largeText"> Enable large text mode</label>
    <label><input type="checkbox" id="highContrast"> High contrast mode</label>
  </div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
  // Tabs logic
  document.querySelectorAll('.tab').forEach(tab => {
    tab.addEventListener('click', () => {
      document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
      tab.classList.add('active');
      document.getElementById('main').style.display = tab.dataset.tab === 'main' ? '' : 'none';
      document.getElementById('settings').style.display = tab.dataset.tab === 'settings' ? '' : 'none';
    });
  });

  const map = L.map('map').setView([0,0],2);
  const maptilerKey = "evu6UnrC9Rogt8JtpljW";
  const openRouteKey = "YOUR_OPENROUTE_KEY";

  L.tileLayer(`https://api.maptiler.com/maps/streets/{z}/{x}/{y}.png?key=${maptilerKey}`, {
    attribution: '© MapTiler © OpenStreetMap contributors'
  }).addTo(map);

  let trafficLayer = null, routeLayer=null, simMarker=null;
  let routeCoords = [], waypoints = [];

  function attachAutocomplete(input){
    // ... (same as before)
  }

  attachAutocomplete(document.getElementById('search'));
  attachAutocomplete(document.getElementById('start'));
  attachAutocomplete(document.getElementById('end'));

  document.getElementById('routeBtn').addEventListener('click', async () => {
    const s = document.getElementById('start'), e = document.getElementById('end');
    if (document.getElementById('useCurrentLocation').checked) {
      await new Promise(resolve => navigator.geolocation.getCurrentPosition(pos => {
        s.value = 'Current Location';
        s.dataset.lat = pos.coords.latitude;
        s.dataset.lon = pos.coords.longitude;
        resolve();
      }));
    }
    if (!s.dataset.lat || !e.dataset.lat) return alert('Start & End must be selected');
    // ... routing logic (same as before)
  });

  // Traffic toggle handler (inserted fully as before)

  map.on('click', e => {
    // waypoint logic
  });

  document.getElementById('simulateBtn').addEventListener('click', () => {
    // simulation logic
  });

  // Accessibility settings handlers:
  document.getElementById('largeText').addEventListener('change', (e) => {
    document.body.style.fontSize = e.target.checked ? '1.3em' : '';
  });
  document.getElementById('highContrast').addEventListener('change', (e) => {
    document.body.style.filter = e.target.checked ? 'contrast(1.5)' : '';
  });
</script>
</body>
</html>
